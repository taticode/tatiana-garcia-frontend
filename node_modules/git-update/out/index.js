"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var parser_1 = require("./parser");
var logger_1 = require("./logger");
var bitbucket_api_1 = require("./api/bitbucket-api");
var gitlab_api_1 = require("./api/gitlab-api");
// do not use this in modules, but only in applications, as otherwise we could have multiple of these bound
process.on('uncaughtException', function (err) {
    // handle the error safely
    logger_1.default.error("please check token, etc. ", err.message);
});
var runGitlab = function () {
    var api = new gitlab_api_1.GitlabApi(parser_1.default);
    if (parser_1.default.list) {
        api.listRepositories();
    }
    else {
        api.cloneOrUpdateRepositories();
    }
};
var runBitbucket = function () {
    var api = new bitbucket_api_1.default(parser_1.default);
    if (parser_1.default.list) {
        api.listRepositories();
    }
    else {
        api.cloneOrUpdateRepositories();
    }
};
var run = function (repoType) {
    if (repoType === "bitbucket") {
        return runBitbucket();
    }
    if (repoType === "gitlab") {
        return runGitlab();
    }
    logger_1.default.error("don't support repotType : " + repoType);
};
exports.default = run;
